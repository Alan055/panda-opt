webpackJsonp([22],{"+AAU":function(e,t){},"4Qya":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("mvHQ"),n=a.n(s),l=a("Xxa5"),i=a.n(l),r=a("exGp"),o=a.n(r),v=a("7+uW"),u=(a("Gs9r"),{name:"OperationalEvents",data:function(){return{addEventsFormRules:{loanstep:[{required:!0,message:"请选借款阶段",trigger:"change"}],eventtype:[{required:!0,message:"请选择系统事件",trigger:"change"}]},eventTab:[{title:"系统事件列表",name:"1",type:"list"}],labelWidth:"120px",showAddBtn:!0,eventsTabIndex:"1",tabIndex:1,eventsList:{list:[{part:"part1",userstatusname:"开户未申请",eventName:"事件1",runTime:"13:00",eventStartTime:"2018-11-10 13 :00",eventEndTime:"2018-11-30 24:00",periodTime:"T+0",events:[{channel:"微信公众号",channelId:"100025",eventContent:"尊敬的用户，您的借款金额已到账，请注意查收",status:1,ABtest:1}]}],total:1},defaultSize:{pageSize:10,pageNumber:1},timePart:[{value:"-10",label:"T-10"},{value:"-9",label:"T-9"},{value:"-8",label:"T-8"},{value:"-7",label:"T-7"},{value:"-6",label:"T-6"},{value:"-5",label:"T-5"},{value:"-4",label:"T-4"},{value:"-3",label:"T-3"},{value:"-2",label:"T-2"},{value:"-1",label:"T-1"},{value:"0",label:"T"},{value:"1",label:"T+1"},{value:"2",label:"T+2"},{value:"3",label:"T+3"},{value:"4",label:"T+4"},{value:"5",label:"T+5"},{value:"7",label:"T+7"},{value:"14",label:"T+14"},{value:"60",label:"T+60"}],allTime:[{value:"00:00:00",label:"00:00:00"},{value:"00:30:00",label:"00:30:00"},{value:"00:59:59",label:"00:59:59"},{value:"01:30:00",label:"01:30:00"},{value:"01:59:59",label:"01:59:59"},{value:"02:30:00",label:"02:30:00"},{value:"02:59:59",label:"02:59:59"},{value:"03:30:00",label:"03:30:00"},{value:"03:59:59",label:"03:59:59"},{value:"04:30:00",label:"04:30:00"},{value:"04:59:59",label:"04:59:59"},{value:"05:30:00",label:"05:30:00"},{value:"05:59:59",label:"05:59:59"},{value:"06:30:00",label:"06:30:00"},{value:"06:59:59",label:"06:59:59"},{value:"07:30:00",label:"07:30:00"},{value:"07:59:59",label:"07:59:59"},{value:"08:30:00",label:"08:30:00"},{value:"08:59:59",label:"08:59:59"},{value:"09:30:00",label:"09:30:00"},{value:"09:59:59",label:"09:59:59"},{value:"10:30:00",label:"10:30:00"},{value:"10:59:59",label:"10:59:59"},{value:"11:30:00",label:"11:30:00"},{value:"11:59:59",label:"11:59:59"},{value:"12:30:00",label:"12:30:00"},{value:"12:59:59",label:"12:59:59"},{value:"13:30:00",label:"13:30:00"},{value:"13:59:59",label:"13:59:59"},{value:"14:30:00",label:"14:30:00"},{value:"14:59:59",label:"14:59:59"},{value:"15:30:00",label:"15:30:00"},{value:"15:59:59",label:"15:59:59"},{value:"16:30:00",label:"16:30:00"},{value:"16:59:59",label:"16:59:59"},{value:"17:30:00",label:"17:30:00"},{value:"17:59:59",label:"17:59:59"},{value:"18:30:00",label:"18:30:00"},{value:"18:59:59",label:"18:59:59"},{value:"19:30:00",label:"19:30:00"},{value:"19:59:59",label:"19:59:59"},{value:"20:30:00",label:"20:30:00"},{value:"20:59:59",label:"20:59:59"},{value:"21:30:00",label:"21:30:00"},{value:"21:59:59",label:"21:59:59"},{value:"22:30:00",label:"22:30:00"},{value:"22:59:59",label:"22:59:59"},{value:"23:30:00",label:"23:30:00"},{value:"23:59:59",label:"23:59:59"}],channelOption:[{value:"1",label:"短信"},{value:"2",label:"App push"},{value:"3",label:"APP站内消息"},{value:"4",label:"自动电话"}],getDisabled:!0,userStatusList:[],userStatusListLoan:[],searchText:"",channelSelect:""}},computed:{stepList:function(){return[{value:"1",label:"贷前"},{value:"2",label:"贷中"},{value:"3",label:"贷后"}]},selectLoanstep:function(){return function(e){for(var t=[],a=0;a<this.userStatusList.length;a++)e==this.userStatusList[a].loanstep&&t.push(this.userStatusList[a]);return t}}},methods:{selectOthers:function(e){},formatStatus:function(e,t){return 0==e.status?"停用":"正常"},formatSteps:function(e,t){switch(e.loanstep){case"1":return"贷前";case"2":return"贷中";case"3":return"贷后"}},handleSizeChange:function(e){this.defaultSize.pageSize=e,this.getSysEventlListById()},handleCurrentChange:function(e){this.defaultSize.pageNumber=e,this.getSysEventlListById()},handleStop:function(e,t){var a=this,s=1==t.status?"停用":"启用";this.$confirm("此操作将"+s+'系统事件 "'+e+'" 是否继续?',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){a.Api.perModUserStatus({id:t.id,status:1==t.status?"0":"1"}).then(function(e){200==e.data.code?(a.$message({type:"success",message:s+"成功!"}),a.$store.dispatch("changeUserList",a.userListParams)):a.$message.error(e.data.msg)})}).catch(function(){a.$message({type:"info",message:"已取消"+s})})},init:function(){this.getSysEventlListById(),this.getSysEventlUserStatus()},getSysEventlListById:function(){var e=this;this.Api.msGetOptEventlListById({pageSize:this.defaultSize.pageSize,pageNumber:this.defaultSize.pageNumber,configtype:1,keyword:this.searchText,messagetype:this.channelSelect}).then(function(t){200==t.data.code?e.eventsList=t.data.data:e.$message.error(t.data.msg)})},download:function(){var e=this;return o()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.Down({keyword:e.searchText,messagetype:e.channelSelect},"/opt/sysEvent/exportSysEventMessageList");case 1:case"end":return t.stop()}},t,e)}))()},getSysEventlUserStatus:function(){var e=this;this.Api.msGetOptEventlUserStatus({}).then(function(t){200==t.data.code&&(e.userStatusList=t.data.data)})},addEvents:function(e,t,a){var s=++this.tabIndex+"";if("add"==t)this.eventTab.push({title:"新增系统事件",name:s,type:"add",addEventsForm:{eventtype:"",messageEventsBeanList:[{messageEventsBeanList:[{messagetype:"",messageid:"",content:""}]}]}}),this.showAddBtn=!1;else if(a){var l=JSON.parse(n()(a.row));this.eventTab.push({title:"编辑系统事件"+(a.$index+1),name:s,type:"edit",addEventsForm:l}),console.log(l)}this.eventsTabIndex=s},removeTab:function(e){var t=this,a=this.eventTab,s=this.eventsTabIndex;a.forEach(function(n,l){if(n.name===e)if("add"==n.type){var i=a[l+1]||a[l-1];i&&(s=i.name),t.showAddBtn=!0}else{var r=a[l+1]||a[l-1];r&&(s=r.name)}}),this.eventsTabIndex=s,this.eventTab=a.filter(function(t){return t.name!==e})},setDisabled:function(e,t,a,s){var n=this;if(this.getDisabled){this.getDisabled=!1;var l=1==e.status?"禁用":"启用";this.$confirm("此操作将"+l+"该渠道 ， 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){n.Api.msUpdateIsProhibit({id:e.id,status:1==e.status?"0":"1"}).then(function(l){200==l.data.code?(n.eventsList.list[s].messageEventsBeanList[t].messageEventsBeanList[a].status=1==e.status?"0":"1",n.getDisabled=!0):(n.getDisabled=!0,n.$message.error(l.data.msg))})}).catch(function(){n.$message({type:"info",message:"已取消"+l}),n.getDisabled=!0})}},setABtest:function(e,t,a,s){var n=this,l=1==e.status?"停用":"开启";this.$confirm("此操作将"+l+"该渠道ABtest， 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){n.Api.msUpdateAbtestById({id:e.id,abtest:1==e.abtest?"0":"1"}).then(function(l){200==l.data.code?n.eventsList.list[s].messageEventsBeanList[t].messageEventsBeanList[a].abtest=1==e.abtest?"0":"1":n.$message.error(l.data.msg)})}).catch(function(){n.$message({type:"info",message:"已取消"+l})})},deleteChannel:function(e,t,a,s){var n=this;this.$confirm("此操作将删除该渠道， 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error",center:!0}).then(function(){n.Api.msDeleteEventById({id:e.id}).then(function(e){200==e.data.code?n.eventsList.list[s].messageEventsBeanList[t].messageEventsBeanList.splice(a,1):n.$message.error(e.data.msg)})}).catch(function(){n.$message({type:"info",message:"已取消删除"})})},addAllocation:function(e){this.eventTab[e].addEventsForm.messageEventsBeanList.push({messageEventsBeanList:[{messagetype:"",messageid:"",content:""}]})},deleteAllocation:function(e,t){this.eventTab[e].addEventsForm.messageEventsBeanList.splice(t,1)},addBeanList:function(e,t){console.log(t),this.eventTab[t].addEventsForm.messageEventsBeanList[e].messageEventsBeanList.push({messagetype:"",messageid:"",content:""})},deleteBeanList:function(e,t,a){this.eventTab[t].addEventsForm.messageEventsBeanList[e].messageEventsBeanList.splice(a,1)},getSysEventDetailById:function(e,t,a,s){var n=this;if(!(e&&e.length>=18))return this.eventTab[a].addEventsForm.messageEventsBeanList[t].messageEventsBeanList[s].content="",!1;this.Api.msGetSysEventDetailById({id:e}).then(function(e){200==e.data.code?e.data.data&&n.eventTab[a].addEventsForm.messageEventsBeanList[t].messageEventsBeanList[s].messagetype==e.data.data.messagetype?n.eventTab[a].addEventsForm.messageEventsBeanList[t].messageEventsBeanList[s].content=e.data.data.content?e.data.data.content:e.data.data.templateid:(n.eventTab[a].addEventsForm.messageEventsBeanList[t].messageEventsBeanList[s].content="",n.$message.error("渠道id不正确或者消息类型不匹配")):(n.eventTab[a].addEventsForm.messageEventsBeanList[t].messageEventsBeanList[s].content="",n.$message.error(e.data.msg))})},saveSysEvent:function(e,t){var a=this;this.$refs[t][0].validate(function(t){if(!t)return!1;var s=0,l=0;"add"==a.eventTab[e].type?a.eventTab[e].addEventsForm.type="2":a.eventTab[e].addEventsForm.type="1";for(var i=a.eventTab[e].addEventsForm,r=0;r<a.eventTab[e].addEventsForm.messageEventsBeanList.length;r++)for(var o=0;o<a.eventTab[e].addEventsForm.messageEventsBeanList[r].messageEventsBeanList.length;o++)l++,i.messageEventsBeanList[r].messageEventsBeanList[o].messagetype?!i.messageEventsBeanList[r].messageEventsBeanList[o].messageid||i.messageEventsBeanList[r].messageEventsBeanList[o].messageid.length<18?(v.default.set(i.messageEventsBeanList[r],"isError",!1),v.default.set(i.messageEventsBeanList[r],"errorText",""),v.default.set(i.messageEventsBeanList[r].messageEventsBeanList[o],"isError",!0),v.default.set(i.messageEventsBeanList[r].messageEventsBeanList[o],"errorText","请输入正确的渠道id"),"请输入正确的渠道id"):(v.default.set(i.messageEventsBeanList[r].messageEventsBeanList[o],"isError",!1),v.default.set(i.messageEventsBeanList[r].messageEventsBeanList[o],"errorText",""),"",s++):(v.default.set(i.messageEventsBeanList[r],"isError",!1),v.default.set(i.messageEventsBeanList[r],"errorText",""),v.default.set(i.messageEventsBeanList[r].messageEventsBeanList[o],"isError",!0),v.default.set(i.messageEventsBeanList[r].messageEventsBeanList[o],"errorText","请选择配置渠道"),"请选择配置渠道");if(console.log("n",l,"count",s),s!=l)return a.$message.error("配置有误"),!1;var u={id:i.id||"",configtype:1,loanstep:i.loanstep,eventtype:i.eventtype,remark:i.remark||"",messageEventsBeanList:i.messageEventsBeanList};a.Api.msSaveSysEvent({data:n()(n()(u)),type:i.type}).then(function(e){200==e.data.code?(a.removeTab(a.eventsTabIndex),a.$message.success("保存成功"),a.getSysEventlListById()):a.$message.error(e.data.msg)})})}},created:function(){this.init()},filters:{filterABtest:function(e){return 1==e?"关闭ABtest":"开启ABtest"},filterStatus:function(e){return 0==e?"启用":"禁用"},filterMessage:function(e){switch(e){case"1":return"短信";case"2":return"App push";case"3":return"APP站内消息";case"4":return"自动电话"}},filterTriggerDay:function(e){for(var t=[{value:"-10",label:"T-10"},{value:"-9",label:"T-9"},{value:"-8",label:"T-8"},{value:"-7",label:"T-7"},{value:"-6",label:"T-6"},{value:"-5",label:"T-5"},{value:"-4",label:"T-4"},{value:"-3",label:"T-3"},{value:"-2",label:"T-2"},{value:"-1",label:"T-1"},{value:"0",label:"T+0"},{value:"1",label:"T+1"},{value:"2",label:"T+2"},{value:"3",label:"T+3"},{value:"4",label:"T+4"},{value:"5",label:"T+5"},{value:"7",label:"T+7"},{value:"14",label:"T+14"},{value:"60",label:"T+60"}],a=0;a<t.length;a++)if(e==t[a].value)return t[a].label}}}),d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"system-view"},[a("transition",{attrs:{name:"el-zoom-in-bottom"}},[a("div",[e.showAddBtn?a("div",{staticClass:"add-btn",on:{click:function(t){e.addEvents(e.eventsTabIndex,"add")}}},[a("i",{staticClass:"el-icon-lx-roundadd"}),e._v("新增系统模块\n      ")]):e._e(),e._v(" "),a("el-tabs",{attrs:{type:"card",closable:""},on:{"tab-remove":e.removeTab},model:{value:e.eventsTabIndex,callback:function(t){e.eventsTabIndex=t},expression:"eventsTabIndex"}},e._l(e.eventTab,function(t,s){return a("el-tab-pane",{key:t.name,attrs:{label:t.title,name:t.name}},[a("div",{staticClass:"events-item"},["list"==t.type?a("div",[a("div",{staticClass:"plugins-search"},[a("el-form",{staticClass:"formTop",attrs:{inline:!0}},[a("div",[a("el-form-item",{attrs:{label:"搜索："}},[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"配置渠道："}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.channelSelect,callback:function(t){e.channelSelect=t},expression:"channelSelect"}},e._l([{label:"全部",value:""}].concat(e.channelOption),function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.defaultSize.pageNumber=1,e.getSysEventlListById()}}},[e._v("搜索\n                      ")]),e._v(" "),a("el-button",{attrs:{type:"warning"},on:{click:function(t){e.download()}}},[e._v("导出")])],1)],1)])],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.eventsList.list}},[a("el-table-column",{attrs:{prop:"events",type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"solt-channel"},e._l(t.row.messageEventsBeanList,function(s,n){return a("div",{key:n,staticClass:"slot-channel"},[a("el-form",{attrs:{"label-position":"right",inlineclass:"demo-table-expand"}},[a("div",[a("el-form-item",{attrs:{label:"跑批时间：","label-width":e.labelWidth}},[a("span",{staticClass:"border"},[e._v("即时发送")])])],1),e._v(" "),e._l(s.messageEventsBeanList,function(s,l){return a("div",{key:l,class:["item-material",0==s.status?"disabled":""]},[a("div",{staticClass:"inline-div inline-small"},[a("el-form-item",{attrs:{label:"配置渠道：","label-width":e.labelWidth}},[a("span",{staticClass:"border"},[e._v(e._s(e._f("filterMessage")(s.messagetype)))])])],1),e._v(" "),a("div",{staticClass:"inline-div"},[a("el-form-item",{attrs:{label:"渠道ID：","label-width":e.labelWidth}},[a("span",{staticClass:"border"},[e._v(e._s(s.messageid||"无"))])])],1),e._v(" "),a("el-form-item",{attrs:{label:"内容：","label-width":e.labelWidth}},[a("span",{staticClass:"border"},[e._v(e._s(s.content||s.templateid||"无"))])]),e._v(" "),a("div",{staticClass:"slot-operation"},[a("el-button",{attrs:{type:"primary",size:"mini",plain:1==s.status},on:{click:function(a){e.setDisabled(s,n,l,t.$index)}}},[e._v("\n                                "+e._s(e._f("filterStatus")(s.status))+"\n                              ")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){e.deleteChannel(s,n,l,t.$index)}}},[e._v("删除\n                              ")])],1)],1)})],2)],1)}))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"序号",type:"index"}}),e._v(" "),a("el-table-column",{attrs:{prop:"loanstep",formatter:e.formatSteps,label:"借款阶段"}}),e._v(" "),a("el-table-column",{attrs:{prop:"eventname",label:"事件/标签",width:"300"}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注"}}),e._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态",formatter:e.formatStatus}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"260"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){e.addEvents(e.eventsTabIndex,"edit",t)}}},[e._v("编辑\n                    ")])]}}])})],1),e._v(" "),a("el-pagination",{attrs:{"current-page":1,"page-sizes":[10,20,30,40],"page-size":10,layout:"total, sizes, prev, pager, next, jumper",total:e.eventsList.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):a("div",{staticClass:"addEvents_ct"},[a("el-form",{ref:"addEventsFormRef"+s,refInFor:!0,attrs:{"label-position":"left","label-width":"100px",model:t.addEventsForm,rules:e.addEventsFormRules,size:"mini"}},[a("el-form-item",{attrs:{label:"借款阶段：",prop:"loanstep"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:function(e){t.addEventsForm.eventtype=""}},model:{value:t.addEventsForm.loanstep,callback:function(a){e.$set(t.addEventsForm,"loanstep",a)},expression:"item.addEventsForm.loanstep"}},e._l(e.stepList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"系统事件：",prop:"eventtype"}},[a("el-select",{staticStyle:{width:"400px"},attrs:{autocomplete:"off",placeholder:"选择用户状态"},model:{value:t.addEventsForm.eventtype,callback:function(a){e.$set(t.addEventsForm,"eventtype",a)},expression:"item.addEventsForm.eventtype"}},e._l(e.selectLoanstep(t.addEventsForm.loanstep),function(e){return a("el-option",{key:e.eventtype,attrs:{label:e.eventname,value:e.eventtype}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"备注(选填)："}},[a("el-input",{model:{value:t.addEventsForm.remark,callback:function(a){e.$set(t.addEventsForm,"remark",a)},expression:"item.addEventsForm.remark"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"系统事件："}},e._l(t.addEventsForm.messageEventsBeanList,function(n,l){return a("div",{key:l,staticClass:"event-item"},[a("div",{staticClass:"event-header"},[a("div",{staticClass:"event-header-left"},[e._v("\n                        配置\n                      ")]),e._v(" "),t.addEventsForm.messageEventsBeanList.length>1?a("div",{staticClass:"event-header-right"},[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){e.deleteAllocation(s,l)}}})],1):e._e()]),e._v(" "),a("div",{class:["event-contain",n.isError?"event-error":""]},[a("el-form-item",{attrs:{label:"发送时间"}},[a("div",[e._v("即时发送")])]),e._v(" "),e._l(n.messageEventsBeanList,function(t,i){return a("el-form-item",{key:i,staticClass:"event-setChannel",class:[t.isError?"event-error":""],attrs:{label:"配置渠道"}},[a("el-select",{attrs:{placeholder:"选择渠道"},on:{change:function(e){t.messageid="",t.content="",t.templateid=""}},model:{value:t.messagetype,callback:function(a){e.$set(t,"messagetype",a)},expression:"channel.messagetype"}},e._l(e.channelOption,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("el-input",{staticStyle:{width:"199.72px"},attrs:{placeholder:"渠道ID"},on:{blur:function(a){e.getSysEventDetailById(t.messageid,l,s,i)}},model:{value:t.messageid,callback:function(a){e.$set(t,"messageid",a)},expression:"channel.messageid"}}),e._v(" "),n.messageEventsBeanList.length>1?a("el-button",{staticStyle:{"margin-left":"15px"},attrs:{type:"danger",icon:"el-icon-minus",circle:""},on:{click:function(t){e.deleteBeanList(l,s,i)}}}):e._e(),e._v(" "),i==n.messageEventsBeanList.length-1?a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:""},on:{click:function(t){e.addBeanList(l,s)}}}):e._e(),e._v(" "),a("div",{staticClass:"event-content"},[e._v("\n                          "+e._s(t.content||t.templateid)+"\n                        ")]),e._v(" "),t.isError?a("div",{staticClass:"el-form-item__error"},[e._v("\n                          "+e._s(t.errorText)+"\n                        ")]):e._e()],1)})],2)])}))],1),e._v(" "),a("el-footer",[a("el-button",{attrs:{plain:"",size:"medium"},on:{click:function(t){e.removeTab(e.eventsTabIndex)}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"medium",plain:""},on:{click:function(t){e.saveSysEvent(s,"addEventsFormRef"+s)}}},[e._v("确定\n                ")])],1)],1)])])}))],1)])],1)},staticRenderFns:[]};var c=a("VU/8")(u,d,!1,function(e){a("q/Ck"),a("+AAU")},null,null);t.default=c.exports},"q/Ck":function(e,t){}});