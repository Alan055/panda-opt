webpackJsonp([43],{kb4S:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("woOf"),i=a.n(n),l={name:"BlockMerchants",data:function(){var e=function(e,t,a){t||a(new Error("请输入手机号码"));var n=/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/;setTimeout(function(){n.test(t)?a():a(new Error("请输入正确的手机号码"))},100)};return{titles:["可屏蔽商户","已选商户"],channelListLoading:!1,searchForm:{mobile:"",financeid:""},addLoading:!1,editLoading:!1,defaultParams:{pageSize:10,pageNumber:1},addChannelList:[{channelname:"",channelid:"",model:"",remark:""}],channelList:[],addChannelDialog:!1,addChannelForm:{mobile:"",remark:"",merchantsList:[]},addChannelFormRules:{},editChannelDialog:!1,editChannelForm:{mobile:"",remark:"",merchantsList:[]},addChannelRules:{mobile:[{validator:e,trigger:"blur",required:!0}],merchantsList:[{trigger:"change",required:!0,type:"array",message:"请至少选择一个商户"}],remark:[{}]},editChannelRules:{mobile:[{validator:e,trigger:"blur",required:!0}],merchantsList:[{trigger:"change",required:!0,type:"array",message:"请至少选择一个商户"}]},optionSearchShielding:[],leftChecked:[]}},computed:{optionShielding:function(){return this.$store.state.optionShielding},optionChannelId:function(){return this.$store.state.optionChannelId}},methods:{init:function(){this.queryProductInfo(),this.getLoanmarketListById()},closeAddChannel:function(e){this.$refs[e].resetFields()},formatModel:function(e,t){switch(e.model){case"1":return"贷超";case"2":return"贷超信用卡"}},formatPhoneNumber:function(e){return e.mobile.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2")},queryProductInfo:function(){var e=this;this.Api.loQueryProductInfo({}).then(function(t){200==t.data.code&&t.data.data.forEach(function(t,a){e.optionSearchShielding.push({label:t.productname,key:t.id,value:t.id})})}).catch(function(e){})},getLoanmarketListById:function(){var e=this;this.channelListLoading=!0,this.Api.loGetMerchantListById({financeid:this.searchForm.financeid||"",mobile:this.searchForm.mobile,pageSize:this.defaultParams.pageSize,pageNumber:this.defaultParams.pageNumber}).then(function(t){200==t.data.code&&(e.channelList=t.data.data,e.channelListLoading=!1)})},handleAdd:function(e,t){console.log(e),console.log(this.addChannelList.length),this.addChannelList.push({channelname:"",channelid:"",model:"",remark:"",err:!1})},handleMinus:function(e,t){for(var a=0;a<this.addChannelList.length;a++)a==e&&this.addChannelList.splice(e,1)},searchChannel:function(){this.defaultParams.pageNumber=1,this.getLoanmarketListById()},handleCurrentChange:function(e){this.defaultParams.pageNumber=e,this.getLoanmarketListById()},handleSizeChange:function(e){this.defaultParams.pageSize=e,this.getLoanmarketListById()},deleteChannel:function(e){var t=this;this.$confirm("此操作将永久删除该黑名单，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error",center:!0}).then(function(){t.Api.loDeleteMerchantListById({id:e.id,userid:e.userid}).then(function(e){200==e.data.code?(t.$message({type:"success",message:"删除成功!"}),t.getLoanmarketListById()):t.$message({type:"error",message:e.data.msg})})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},addChannel:function(){this.addChannelDialog=!0},tableRowClassName:function(e){var t=e.row;e.rowIndex;return 1==t.err?"warning-row":""},sureSaveChannel:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.addLoading=!0;for(var a=t.addChannelForm.merchantsList,n="",i="",l=0;l<a.length;l++){0==n.length?n=a[l]:n+=","+a[l];for(var r=0;r<t.optionSearchShielding.length;r++)a[l]==t.optionSearchShielding[r].key&&(i=0==i.length?t.optionSearchShielding[r].label:i+","+t.optionSearchShielding[r].label)}t.Api.loInsertMerchantListById({mobile:t.addChannelForm.mobile,financeid:n,financename:i,remark:t.addChannelForm.remark}).then(function(e){200==e.data.code?(t.$message.success("保存成功"),t.getLoanmarketListById(),t.addChannelDialog=!1):t.$message.error(e.data.msg),t.addLoading=!1}).catch(function(e){t.addLoading=!1})})},editChannel:function(e){this.editChannelFrom=i()(this.editChannelForm,e),this.editChannelFrom.merchantsList=this.editChannelFrom.financeid.split(","),console.log(this.editChannelFrom),this.editChannelDialog=!0},closeDialog:function(e){this.$refs[e].resetFields()},sureSaveEditChannel:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.editLoading=!0;for(var a=t.editChannelFrom.merchantsList,n="",i="",l=0;l<a.length;l++){0==n.length?n=a[l]:n+=","+a[l];for(var r=0;r<t.optionSearchShielding.length;r++)a[l]==t.optionSearchShielding[r].key&&(i=0==i.length?t.optionSearchShielding[r].label:i+","+t.optionSearchShielding[r].label)}t.Api.loInsertMerchantListById({mobile:t.editChannelFrom.mobile,financeid:n,financename:i,id:t.editChannelFrom.id,remark:t.editChannelFrom.remark}).then(function(e){t.editLoading=!1,200==e.data.code?(t.$message.success("保存成功"),t.getLoanmarketListById(),t.editChannelDialog=!1):t.$message.error(e.data.msg)}).catch(function(e){t.editLoading=!1})})}},created:function(){this.init()}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"blockMerchants-view"},[a("div",{staticClass:"container"},[a("div",{staticClass:"plugins-tips"},[a("div",{staticClass:"plugins-search"},[a("el-form",[a("el-row",{attrs:{gutter:40}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"手机号",labelWidth:"60px"}},[a("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:e.searchForm.mobile,callback:function(t){e.$set(e.searchForm,"mobile",t)},expression:"searchForm.mobile"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"屏蔽商户",labelWidth:"80px"}},[a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择"},model:{value:e.searchForm.financeid,callback:function(t){e.$set(e.searchForm,"financeid",t)},expression:"searchForm.financeid"}},e._l(e.optionSearchShielding,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{label:"",labelWidth:"1px"}},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.searchChannel}},[e._v("搜索")])],1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"add-btn",on:{click:e.addChannel}},[a("i",{staticClass:"el-icon-lx-roundadd"}),e._v("新增商户黑名单\n            ")])]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.channelListLoading,expression:"channelListLoading"}],staticStyle:{width:"100%"},attrs:{data:e.channelList.list,border:""}},[a("el-table-column",{attrs:{label:"序号",type:"index"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createtime",label:"上线日期",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"mobile",label:"手机号",width:"120",formatter:e.formatPhoneNumber}}),e._v(" "),a("el-table-column",{attrs:{prop:"financename",label:"商户名称",width:"260"}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注"}}),e._v(" "),a("el-table-column",{attrs:{prop:"updatetime",label:"最后修改时间"}}),e._v(" "),a("el-table-column",{attrs:{prop:"updateby",label:"最后修改人"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){e.editChannel(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(a){e.deleteChannel(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-pagination",{attrs:{"current-page":e.defaultParams.pageNumber,"page-sizes":[10,20,30,40],"page-size":10,layout:"total, sizes, prev, pager, next, jumper",total:e.channelList.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.addLoading,expression:"addLoading"}],staticClass:"addChannelDialog",attrs:{title:"新增商户黑名单",width:"50%",center:"",visible:e.addChannelDialog},on:{"update:visible":function(t){e.addChannelDialog=t},closed:function(t){e.closeAddChannel("addChannelForm")}}},[a("el-form",{ref:"addChannelForm",attrs:{model:e.addChannelForm,rules:e.addChannelRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"手机号",prop:"mobile"}},[a("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:e.addChannelForm.mobile,callback:function(t){e.$set(e.addChannelForm,"mobile",t)},expression:"addChannelForm.mobile"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:e.addChannelForm.remark,callback:function(t){e.$set(e.addChannelForm,"remark",t)},expression:"addChannelForm.remark"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"屏蔽商户",prop:"merchantsList"}},[[a("el-transfer",{attrs:{filterable:"","filter-placeholder":"请输入商户搜索",titles:e.titles,"left-default-checked":e.leftChecked,data:e.optionSearchShielding},model:{value:e.addChannelForm.merchantsList,callback:function(t){e.$set(e.addChannelForm,"merchantsList",t)},expression:"addChannelForm.merchantsList"}})]],2)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addChannelDialog=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.sureSaveChannel("addChannelForm")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.editLoading,expression:"editLoading"}],attrs:{title:"编辑商户黑名单",width:"50%",center:"",visible:e.editChannelDialog},on:{"update:visible":function(t){e.editChannelDialog=t},closed:function(t){e.closeDialog("editChannelForm")}}},[a("el-form",{ref:"editChannelForm",attrs:{model:e.editChannelForm,rules:e.editChannelRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"手机号",prop:"mobile"}},[a("el-input",{attrs:{value:e.formatPhoneNumber(e.editChannelForm),readonly:"",placeholder:"请输入手机号"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:e.editChannelForm.remark,callback:function(t){e.$set(e.editChannelForm,"remark",t)},expression:"editChannelForm.remark"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"屏蔽商户",prop:"merchantsList"}},[[a("el-transfer",{attrs:{filterable:"","filter-placeholder":"请输入商户搜索",titles:e.titles,"left-default-checked":e.leftChecked,data:e.optionSearchShielding},model:{value:e.editChannelForm.merchantsList,callback:function(t){e.$set(e.editChannelForm,"merchantsList",t)},expression:"editChannelForm.merchantsList"}})]],2)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.editChannelDialog=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.sureSaveEditChannel("editChannelForm")}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var o=a("VU/8")(l,r,!1,function(e){a("thzp")},null,null);t.default=o.exports},thzp:function(e,t){}});