webpackJsonp([23],{H4S9:function(e,t){},NhoH:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("vjgg"),l=a("fMLZ"),n={mixins:[a("KvOm").b],name:"SmgGroupsent",data:function(){var e=this;return{apiUrl:l.a,dialogTableVisible:!1,changeRecordList:[],exportLoading:!1,loading:!0,pageNumber:1,pageSize:10,statusOption:[{label:"已发送",value:3},{label:"未发送",value:0}],jumpType:[{label:"无",value:"1"},{label:"外链",value:"2"},{label:"内链",value:"3"}],formDataRules:{pushId:[{required:!0,validator:function(t,a,l){var n=e;if(!a)return l(new Error("短信 Id不能为空"));a.length<18?l(new Error("请输入正确长度的短信ID")):(e.formLoading=!0,s.a.msGetSysEventDetailById({id:a}).then(function(t){e.formLoading=!1,200==t.data.code?t.data.data?"1"==t.data.data.messagetype?(e.Api.msGetSysEventDetailById({id:e.formData.pushId}).then(function(t){200==t.data.code?t.data.data?"1"==t.data.data.messagetype?(e.formData.content=t.data.data.content,e.formData.jumpType=null==t.data.data.jumpinner?2:t.data.data.jumpinner,e.formData.jumpLink=t.data.data.gotourl||"",e.formData.title=t.data.data.title||""):l(new Error("请输入短信类型的id")):l(new Error("渠道id不正确或者消息类型不匹配")):(e.formData.content="",l(new Error(t.data.msg)))}),l()):l(new Error("请输入短信类型的id")):l(new Error("渠道id不正确或者消息类型不匹配")):(n.formData.content="",l(new Error(t.data.msg)))}).catch(function(t){e.formLoading=!1,l(new Error(t.msg))}))},trigger:"blur"}]},formData:{pushId:"",content:"",title:""},checkStatus:3,queryMassMessageMassList:[],listPushObject:"0",searchList:"",isIndeterminate:!1,checkedTables:[],checkAll:!0,tableOptions:[{label:"序号",prop:"",type:"index"},{label:"群发Id",prop:"id",type:"normal"},{label:"创建时间",prop:"createTime",type:"time"},{label:"群发时间",prop:"expectTime",type:"time"},{label:"群发对象",prop:"type",type:"filter",formatters:this.filterObj},{label:"消息内容",prop:"content",type:"content"},{label:"群发数量",prop:"smsTotal",type:"normal"},{label:"下发成功数",prop:"successTotal",type:"normal"},{label:"下发失败数",prop:"failTotal",type:"normal"},{label:"状态",prop:"status",type:"filter",formatters:this.filterStatus}]}},computed:{optionJumpType:function(){return[{value:0,label:"跳转外链"},{value:1,label:"跳转内链"},{value:2,label:"只显示不跳转"}]},codeLength:function(){for(var e=0,t=this.formData.content,a=0;a<t.length;a++){var s=t.charCodeAt(a);e+=s>=0&&s<=255||s>=65377&&s<=65439?1:2}return e>=200&&(this.formData.content=t.substr(0,e)),e},widthTh:function(){return function(e){return"content"==e?"300":"time"==e?"150":""}}},methods:{exportList:function(){var e=this;this.exportLoading=!0;var t=this.apiUrl+"/opt/smsmass/exportSmsMessageList?status="+this.checkStatus+"&sendType="+this.listPushObject+"&keyword="+this.searchList;window.location.href=t,setTimeout(function(){e.exportLoading=!1},1e3)},sendApply:function(e){var t=this,a=void 0;if(this.$refs.bulkData.validate(function(e){a=e}),this.$refs.formData.validate(function(e){e}),a&&a){this.formLoading=!0;var l={type:this.bulkData.pushObject,expectTime:String(new Date(this.bulkData.sendTime)),smsType:this.bulkData.businessType,id:this.formData.pushId};switch(this.bulkData.pushObject){case"1":l.smsTotal=this.userNumber,l.fileId=this.bulkData.fileList[0].uid;break;case"2":l.inputUser=this.bulkData.pushObjectList,l.smsTotal=this.inputNumber;break;case"3":this.organizeData(l)}s.a.sentSaveBatchInfo(l).then(function(e){200==e.data.code?(t.$refs.upload.clearFiles(),t.$refs.bulkData.resetFields(),t.$refs.formData.resetFields(),t.formData.content="",t.formData.title="",t.userNumber=0,t.inputNumber=0,t.$message({type:"success",message:"提交成功"}),t.getQueryMassMessageMassLi()):t.$message({type:"error",message:e.data.msg}),t.formLoading=!1}).catch(function(e){t.$message({type:"error",message:"异常错误"}),t.formLoading=!1})}},testApply:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.$prompt("请输入测试手机号码","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0,inputPattern:/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/,inputErrorMessage:"请输入正确的手机号码"}).then(function(e){var a=e.value;t.formLoading=!0,s.a.auSendSmsTest({messageid:t.formData.pushId,mobile:a}).then(function(e){200==e.data.code?t.$message({type:"success",message:"发送成功"}):t.$message({type:"error",message:e.data.msg}),t.formLoading=!1}).catch(function(e){t.formLoading=!1,t.$message({type:"error",message:e.msg})})}).catch(function(){t.$message({type:"info",message:"取消测试"})})})},handleCurrentChange:function(e){this.pageNumber=e,this.getQueryMassMessageMassLi()},handleSizeChange:function(e){this.pageSize=e,this.getQueryMassMessageMassLi()},keyWordSearch:function(){this.pageSize=10,this.pageNumber=1,this.getQueryMassMessageMassLi()},listPushObjectChange:function(){this.pageSize=10,this.pageNumber=1,this.getQueryMassMessageMassLi()},getCheckStatus:function(e){this.pageSize=10,this.pageNumber=1,"未发送"==e?this.getQueryMassMessageMassLi("0"):this.getQueryMassMessageMassLi("1")},getQueryMassMessageMassLi:function(){var e=this;this.loading=!0,this.loading=!0,s.a.sentQueryMassMessageMassList({messagetype:1,pageSize:this.pageSize,pageNumber:this.pageNumber,status:this.checkStatus,sendType:this.listPushObject,keyword:this.searchList}).then(function(t){console.log(t),200==t.data.code?e.queryMassMessageMassList=t.data.data:e.$message({type:"error",message:t.data.msg}),e.loading=!1}).catch(function(t){e.loading=!1})},getSysEventDetailById:function(){var e=this;this.formData.content="",this.formData.jumpType="",this.formData.jumpLink="",this.formData.pushId&&this.formData.pushId.length>=18&&this.Api.msGetSysEventDetailById({id:this.formData.pushId}).then(function(t){200==t.data.code?t.data.data?"1"==t.data.data.messagetype?(e.formData.content=t.data.data.content,e.formData.title=t.data.data.title,e.formData.jumpType=t.data.data.jumpinner||0,e.formData.jumpLink=t.data.data.gotourl||""):e.$message.error("请输入Push类型的id"):e.$message.error("渠道id不正确或者消息类型不匹配"):(e.formData.content="",e.$message.error(t.data.msg))})},changeRecord:function(e,t){var a=this;s.a.sentQueryUpdatelogByid({id:t.id,messagetype:1}).then(function(e){200==e.data.code?(a.changeRecordList=e.data.data,a.dialogTableVisible=!0):a.$message({type:"error",message:e.data.msg})}).catch(function(e){a.$message({type:"error",message:"服务器繁忙，请稍后再试"})})},handleCheckAllChange:function(e){this.checkedTables=e?this.tableOptions:[],this.isIndeterminate=!1},handleCheckedChange:function(e){console.log(e);var t=e.length;this.checkAll=t===this.tableOptions.length,this.isIndeterminate=t>0&&t<this.tableOptions.length},filterJumptype:function(e,t){switch(e.jumptype){case 1:return"内部打开h5链接";case 2:return"外部打开h5链接";case 3:return"仅展示不跳转"}},filterObj:function(e,t){switch(e.type){case 0:return"全部";case 1:return"用户包";case 2:return"指定用户"}},filterType:function(e,t){switch(e.type){case 1:return"新增";case 2:return"审核通过";case 3:return"审核拒绝"}}},created:function(){var e=this;this.$nextTick(function(){e.getQueryMassMessageMassLi()})}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"pushGroup"},[a("transition",{attrs:{name:"el-zoom-in-bottom"}},[a("div",[a("el-tabs",{attrs:{type:"border-card"}},[a("el-tab-pane",{attrs:{label:"新建群发"}},[a("div",{staticClass:"plugins-tips"},[e._v("\n            为保障用户体验，短信消息群发请务必严谨，下发前请先内部测试，确认无误后再对用户进行批量下发。晚上10:00至早上8:00禁止对用户下发。\n          ")]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}]},[a("div",{staticClass:"content-form"},[a("el-form",{ref:"bulkData",attrs:{model:e.bulkData,rules:e.bulkDataRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"群发对象：",prop:"pushObject"}},[a("el-select",{attrs:{placeholder:"请选择群发对象"},on:{change:e.changePushObject},model:{value:e.bulkData.pushObject,callback:function(t){e.$set(e.bulkData,"pushObject",t)},expression:"bulkData.pushObject"}},e._l(e.objectOption,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1==e.bulkData.pushObject,expression:"bulkData.pushObject == 1"}],attrs:{prop:"fileList"}},[a("el-upload",{ref:"upload",attrs:{action:e.saveUrl,"with-credentials":e.actionWidth,"on-success":e.handleAvatarSuccess1,"before-upload":e.beforeAvatarUpload1,"on-remove":e.removeFile,"on-change":e.fileChange,"file-list":e.bulkData.fileList,limit:e.fileNumber,"on-exceed":e.fileExceed}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传txt文件，且用户数量不超过5万条")])],1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:2==e.bulkData.pushObject,expression:"bulkData.pushObject == 2"}],attrs:{prop:"pushObjectList"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"用户ID，限20个，请用逗号隔开"},model:{value:e.bulkData.pushObjectList,callback:function(t){e.$set(e.bulkData,"pushObjectList",t)},expression:"bulkData.pushObjectList"}})],1),e._v(" "),1==e.bulkData.pushObject||2==e.bulkData.pushObject?a("el-form-item",{attrs:{label:"已选择用户："}},[1==e.bulkData.pushObject?a("div",[e._v(e._s(e.userNumber))]):a("div",[e._v(e._s(e.inputNumber))])]):e._e(),e._v(" "),3==e.bulkData.pushObject?a("el-form-item",{attrs:{label:"标签名称：",prop:"labelName"}},[a("el-select",{attrs:{clearable:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入标签名称","remote-method":e.findTabName,loading:e.labelName_loading},on:{change:e.findTabNameDes,clear:e.findTabName},model:{value:e.bulkData.labelName,callback:function(t){e.$set(e.bulkData,"labelName",t)},expression:"bulkData.labelName"}},e._l(e.labelNameOption,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1):e._e(),e._v(" "),3==e.bulkData.pushObject?a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.operatingNameOption.length,expression:"operatingNameOption.length"}],attrs:{label:"操作名称："}},[a("el-select",{attrs:{placeholder:"请选择操作名称"},on:{change:e.changeOperatingName},model:{value:e.bulkData.operatingName,callback:function(t){e.$set(e.bulkData,"operatingName",t)},expression:"bulkData.operatingName"}},e._l(e.operatingNameOption,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e}})}))],1):e._e(),e._v(" "),3==e.bulkData.pushObject?a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.operatingOption.length,expression:"operatingOption.length"}],attrs:{label:"操作："}},[a("el-select",{attrs:{placeholder:"请选择操作"},model:{value:e.bulkData.operating,callback:function(t){e.$set(e.bulkData,"operating",t)},expression:"bulkData.operating"}},e._l(e.operatingOption,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e}})}))],1):e._e(),e._v(" "),3==e.bulkData.pushObject?a("el-form-item",{attrs:{label:"操作内容："}},[e.operatingContentOption.length?a("el-select",{attrs:{placeholder:"请选择操作"},model:{value:e.bulkData.operatingContent,callback:function(t){e.$set(e.bulkData,"operatingContent",t)},expression:"bulkData.operatingContent"}},e._l(e.operatingContentOption,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})):a("el-input",{staticStyle:{width:"300px"},attrs:{type:"text",placeholder:"请输入操作内容"},model:{value:e.bulkData.operatingContent,callback:function(t){e.$set(e.bulkData,"operatingContent","string"==typeof t?t.trim():t)},expression:"bulkData.operatingContent"}}),e._v(" "),a("el-button",{staticStyle:{"margin-left":"15px"},attrs:{type:"primary",disabled:!e.canBuildOperate},on:{click:function(t){e.buildOperation()}}},[e._v("生成操作\n                  ")])],1):e._e(),e._v(" "),3==e.bulkData.pushObject?a("el-form-item",{staticClass:"operatingContentList",attrs:{prop:"operatingContentList"}},e._l(e.bulkData.operatingContentList,function(t,s){return a("div",{key:s,staticClass:"item"},[a("p",{attrs:{title:t.label},domProps:{innerHTML:e._s(t.label)}}),e._v(" "),a("em",{staticClass:"el-icon-circle-close",on:{click:function(t){e.removeOperate(s)}}})])})):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"群发时间：",prop:"sendTime"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime","picker-options":e.pickerOptions1,placeholder:"选择群发时间"},model:{value:e.bulkData.sendTime,callback:function(t){e.$set(e.bulkData,"sendTime",t)},expression:"bulkData.sendTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"业务类型：",prop:"businessType"}},[a("el-select",{attrs:{placeholder:"请选业务类型"},model:{value:e.bulkData.businessType,callback:function(t){e.$set(e.bulkData,"businessType",t)},expression:"bulkData.businessType"}},e._l(e.businessTypeOption,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),a("el-form",{ref:"formData",attrs:{model:e.formData,rules:e.formDataRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"短信 ID：",prop:"pushId"}},[a("el-input",{attrs:{type:"text",placeholder:"短信 ID"},model:{value:e.formData.pushId,callback:function(t){e.$set(e.formData,"pushId",t)},expression:"formData.pushId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"短信标题："}},[a("el-input",{attrs:{type:"input",disabled:"",placeholder:"输入短信id自动填充标题"},model:{value:e.formData.title,callback:function(t){e.$set(e.formData,"title",t)},expression:"formData.title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"短信内容："}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},disabled:"",placeholder:"输入Push ID后自动填充Push内容"},model:{value:e.formData.content,callback:function(t){e.$set(e.formData,"content",t)},expression:"formData.content"}}),e._v(" "),a("div",{class:["contentLength",e.codeLength>=200?"redText":""]},[e._v(e._s(e.codeLength)+"/200")])],1)],1)],1),e._v(" "),a("div",{staticClass:"content-submit-btn"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.sendApply("formData")}}},[e._v("发送申请")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.testApply("formData")}}},[e._v("测试发送")])],1)])]),e._v(" "),a("el-tab-pane",{directives:[{name:"loading",rawName:"v-loading",value:e.exportLoading,expression:"exportLoading"}],attrs:{label:"群发列表"}},[a("div",{staticClass:"plugins-tips"},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"状态："}},[a("el-radio-group",{on:{change:e.getCheckStatus},model:{value:e.checkStatus,callback:function(t){e.checkStatus=t},expression:"checkStatus"}},e._l(e.statusOption,function(t){return a("el-radio-button",{key:t.value,attrs:{label:t.value,value:t.value}},[e._v("\n                    "+e._s(t.label)+"\n                  ")])}))],1),e._v(" "),a("el-form-item",{attrs:{label:"群发对象："}},[a("el-select",{attrs:{placeholder:"请选群发对象"},on:{change:e.listPushObjectChange},model:{value:e.listPushObject,callback:function(t){e.listPushObject=t},expression:"listPushObject"}},e._l([{label:"全部",value:"0"}].concat(e.objectOption),function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"搜索："}},[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容"},model:{value:e.searchList,callback:function(t){e.searchList=t},expression:"searchList"}},[a("el-button",{attrs:{slot:"append",type:"primary"},on:{click:e.keyWordSearch},slot:"append"},[e._v("搜索")])],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.exportList}},[e._v("导出")])],1)],1),e._v(" "),a("el-form",{attrs:{inline:!1}},[a("el-form-item",{attrs:{label:"选择表格显示项"}},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选\n                ")]),e._v(" "),a("div",{staticStyle:{margin:"15px 0"}}),e._v(" "),a("el-checkbox-group",{on:{change:e.handleCheckedChange},model:{value:e.checkedTables,callback:function(t){e.checkedTables=t},expression:"checkedTables"}},e._l(e.tableOptions,function(t,s){return a("el-checkbox",{key:s,attrs:{checked:"",label:t}},[e._v("\n                    "+e._s(t.label)+"\n                  ")])}))],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{stripe:"",data:e.queryMassMessageMassList.list||[],border:""}},[e._l(e.checkedTables,function(t){return["popover"==t.type?a("el-table-column",{key:t.label,attrs:{prop:t.prop,label:t.label,type:"index"==t.type?"index":"",width:e.widthTh(t.type),formatter:t.formatters},scopedSlots:e._u([{key:"default",fn:function(s){return[a("el-popover",{attrs:{placement:"top-start",trigger:"click",content:s.row.url}},[a("el-button",{attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(t.popoverTitle))])],1)]}}])}):a("el-table-column",{key:t.label,attrs:{prop:t.prop,label:t.label,type:"index"==t.type?"index":"",width:e.widthTh(t.type),formatter:t.formatters}})]}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"120",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.changeRecord(t.$index,t.row)}}},[e._v("变更记录\n                ")])]}}])})],2),e._v(" "),a("el-pagination",{attrs:{"current-page":e.pageNumber,"page-size":e.pageSize,"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next, jumper",total:e.queryMassMessageMassList.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"变更记录",visible:e.dialogTableVisible,width:"60%"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-table",{attrs:{data:e.changeRecordList}},[a("el-table-column",{attrs:{property:"type",label:"类型",formatter:e.filterType}}),e._v(" "),a("el-table-column",{attrs:{property:"time",label:"时间"}}),e._v(" "),a("el-table-column",{attrs:{property:"reason",label:"原因"}}),e._v(" "),a("el-table-column",{attrs:{property:"dealman",label:"处理人"}})],1)],1)],1)])],1)},staticRenderFns:[]};var r=a("VU/8")(n,i,!1,function(e){a("sNOM"),a("H4S9")},"data-v-101875d4",null);t.default=r.exports},sNOM:function(e,t){}});