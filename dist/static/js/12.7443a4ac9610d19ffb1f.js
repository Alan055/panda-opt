webpackJsonp([12],{"5BH6":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("fZjL"),r=i.n(a),s=i("mvHQ"),l=i.n(s),o=i("G0J2"),d=(i("fMLZ"),{name:"StartFigure",data:function(){var e=this;return{editDisabled:!1,actionWidth:!0,bigImgUrlDialog:!1,canDrag:!0,imgPercent:0,loaded:!1,bigImgUrl:"",content:"",startTitle:"",dialogFormVisible:!1,activeName:"first",addForm:{type:"",isDefault:"",openType:"",theHref:"",dateTime:""},editForm:{advertid:"",icontext:"",devicetype:"",imgsize:"",isdefault:"",jumptype:"",userstatus:"",starttime:"",endtime:"",frequency:"",jumplink:"",fileid:"",advertList:[{advertid:"",fileid:"",filename:"",imgmeasure:"",imgsize:"",imgurl:""},{advertid:"",fileid:"",filename:"",imgmeasure:"",imgsize:"",imgurl:""}]},startRules:{icontext:[{required:!0,message:"请输入图片名称"}],devicetype:[{required:!0,message:"请选择分类"}],isdefault:[{required:!0,message:"请选择是否默认图"}],jumptype:[{required:!0,message:"请选择打开类型"}],jumplink:[{required:!0,message:"请输入跳转链接"}],starttime:[{required:!0,message:"请选择开始时间"},{validator:function(t,i,a){""===i?a(new Error("请输入开始时间")):(""!==e.editForm.endtime&&e.$refs.editForm.validateField("endtime"),a())},trigger:"change"}],endtime:[{required:!0,message:"请选择结束时间"},{validator:function(t,i,a){""===i?a(new Error("请输入结束时间")):i<e.editForm.starttime?a(new Error("结束时间不能小于开始时间!")):a()},trigger:"change"}],imgmeasure:[{required:!0,message:"请上传图片"}],imgsize:[{required:!0,message:"请上传图片"}],imgmeasure1:[{required:!0,message:"请上传图片"}],imgsize1:[{required:!0,message:"请上传图片"}]},pictureLimit:1,canEdit:!1,imageUrl:"",imageUrl1:"",pageSize:10,pageNum:1,startfigure:[],deviceType:"1",optionDevice:[{label:"android",value:"1"},{label:"ios",value:"2"}]}},components:{quillEditor:o.quillEditor},computed:{optionsOpen:function(){return this.$store.state.optionsOpen},startOptionDeviceType:function(){return this.$store.state.startOptionDeviceType},optionDefault:function(){return this.$store.state.optionDefault},actionUrl:function(){return this.$store.state.actionUrl}},methods:{init:function(){this.changeStartFigureList()},handleClick:function(){},handleStop:function(e,t){var i=this,a=1==t.status?"停用":"启用";this.$confirm("此操作将"+a+'启动图 "'+t.icontext+'" 是否继续?',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){i.Api.maUpdateStatus({oldIds:t.oldIds,status:1==t.status?"0":"1",detailid:t.detailid||""}).then(function(e){200==e.data.code?(i.$message({type:"success",message:a+"成功!"}),i.changeStartFigureList()):i.$message.error(e.data.msg)})}).catch(function(){i.$message({type:"info",message:"已取消"+a})})},checkAllStatus:function(e){this.changeStartFigureList()},formatDate:function(e,t){return e.starttime+" 至 "+e.endtime},formatStatus:function(e,t){return 0==e.status?"已停用":"已启用"},formatDefault:function(e,t){return 1==e.isdefault?"是":"否"},changeStartFigureList:function(){var e=this;this.Api.maGetAdvertListBatch({positionId:"1003001",deviceType:this.deviceType,pageSize:this.pageSize,pageNum:this.pageNum}).then(function(t){if(200==t.data.code){e.startfigure=t.data.data;for(var i=0;i<e.startfigure.list.length;i++)e.startfigure.list[i].advertList=e.startfigure.list[i].advertList.reverse()}else e.$message.error(t.data.msg)})},addDialog:function(){this.startTitle="添加启动图",this.dialogFormVisible=!0},onEditorChange:function(e){e.editor;var t=e.html;e.text;this.content=t},submit:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;t.saveStartFigure()})},saveStartFigure:function(){var e=this,t=String(new Date(this.editForm.starttime)),i=String(new Date(this.editForm.endtime)),a=[];a="1"==this.editForm.devicetype?[{advertid:this.editForm.advertList[0].advertid||"",fileid:this.editForm.advertList[0].fileid,filename:this.editForm.advertList[0].filename,imgsize:this.editForm.advertList[0].imgsize,imgmeasure:this.editForm.advertList[0].imgmeasure}]:[{advertid:this.editForm.advertList[0].advertid||"",fileid:this.editForm.advertList[0].fileid,filename:this.editForm.advertList[0].filename,imgsize:this.editForm.advertList[0].imgsize,imgmeasure:this.editForm.advertList[0].imgmeasure},{advertid:this.editForm.advertList[1].advertid||"",fileid:this.editForm.advertList[1].fileid,filename:this.editForm.advertList[1].filename,imgsize:this.editForm.advertList[1].imgsize,imgmeasure:this.editForm.advertList[1].imgmeasure}];var r={oldIds:this.editForm.oldIds,icontext:this.editForm.icontext,positionid:"1003001",advertid:this.editForm.advertid||"",relid:this.editForm.relid||"",devicetype:this.editForm.devicetype,isdefault:this.editForm.isdefault,jumptype:this.editForm.jumptype,starttime:t,endtime:i,jumplink:this.editForm.jumplink,frequency:this.editForm.frequency,advertListStr:l()(l()(a)),detailid:this.editForm.detailid||""};this.Api.maSaveAdvertBatch(r).then(function(t){200==t.data.code?(e.$message.success("保存成功"),e.dialogFormVisible=!1,e.changeStartFigureList()):e.$message.error(t.data.msg)})},handleAvatarSuccess:function(e,t){var i=this;this.$message.success("上传成功"),this.imageUrl=URL.createObjectURL(t.raw);var a=new Image;a.src=this.imageUrl,a.onload=function(){i.editForm.advertList[0].imgmeasure=a.width+"*"+a.height,i.editForm.advertList[0].imgsize=(t.size/1024).toFixed(2)+"KB",i.editForm.advertList[0].imgurl=i.imageUrl,i.editForm.advertList[0].fileid=e.data.id,i.editForm.advertList[0].filename=t.name,console.log(i.editForm.fileid)},this.loaded=!1},beforeAvatarUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type||"image/gif"===e.type,i=e.size/1024/1024<1;return t?i?(this.loaded=!0,t&&i):(this.$message.error("上传图片大小不能超过1MB!"),void(this.loaded=!1)):(this.$message.error("上传启动图只能是PNG或者JPG 格式!"),void(this.loaded=!1))},handleUploading:function(e,t,i){},handleAvatarSuccess1:function(e,t){var i=this;this.$message.success("上传成功"),this.imageUrl1=URL.createObjectURL(t.raw);var a=new Image;a.src=this.imageUrl1,a.onload=function(){i.editForm.advertList[1].imgmeasure=a.width+"*"+a.height,i.editForm.advertList[1].imgsize=(t.size/1024).toFixed(2)+"KB",i.editForm.advertList[1].imgurl=i.imageUrl1,i.editForm.advertList[1].fileid=e.data.id,i.editForm.advertList[1].filename=t.name,console.log(i.editForm.fileid)},this.loaded=!1},beforeAvatarUpload1:function(e){var t="image/jpeg"===e.type||"image/png"===e.type||"image/gif"===e.type,i=e.size/1024/1024<1;return t?i?(this.loaded=!0,t&&i):(this.$message.error("上传图片大小不能超过1MB!"),void(this.loaded=!1)):(this.$message.error("上传启动图只能是PNG或JPG 格式!"),void(this.loaded=!1))},handleUploading1:function(e,t,i){},editDetail:function(e,t){this.startTitle="编辑启动图",this.dialogFormVisible=!0,this.editForm=JSON.parse(l()(t)),this.editDisabled=!0},deletStart:function(e,t){var i=this;this.$confirm("此操作将永久删除启动图，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error",center:!0}).then(function(){i.Api.maDelAdvert({advertId:t.advertid,detailId:t.detailid}).then(function(e){200==e.data.code?(i.$message({type:"success",message:"删除成功!"}),i.changeStartFigureList()):i.$message.error(e.data.msg)})}).catch(function(){i.$message({type:"info",message:"已取消删除"})})},resetForm:function(e){this.$refs[e].resetFields()},closeDialog:function(){var e=this;this.resetForm("editForm"),r()(this.editForm).forEach(function(t){"dateTime"==t?e.editForm.dateTime=[]:e.editForm[t]="advertList"==t?[{imgmeasure:"",imgsize:"",imgurl:""},{imgmeasure:"",imgsize:"",imgurl:""}]:""}),this.editDisabled=!1},handleSizeChangeAll:function(e){this.pageSize=e,this.changeStartFigureList()},handleCurrentChangeAll:function(e){this.pageNum=e,this.changeStartFigureList()}},mounted:function(){this.init()},watch:{},filters:{jumpType:function(e){switch(e){case 1:return"内部打开h5链接";case 2:return"外部打开h5链接";case 3:return"仅展示不跳转"}}}}),n={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("transition",{attrs:{name:"el-zoom-in-bottom"}},[i("div",[i("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.checkAllStatus},model:{value:e.deviceType,callback:function(t){e.deviceType=t},expression:"deviceType"}},e._l(e.optionDevice,function(t){return i("el-tab-pane",{key:t.value,attrs:{label:t.label,name:t.value}},[i("div",{staticClass:"plugins-tips"},[e._v("\n                        为保障用户体验，启动图统一为PNG、jpg、gif格式，尺寸：720*1280px，大小不超过1M。\n                        "),i("div",{staticClass:"add-btn",on:{click:e.addDialog}},[i("i",{staticClass:"el-icon-lx-roundadd"}),e._v("新增启动图\n                        ")])]),e._v(" "),[[i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.startfigure.list,border:""}},[i("el-table-column",{attrs:{type:"index",label:"序号"}}),e._v(" "),i("el-table-column",{attrs:{prop:"icontext",label:"启动图名称",width:"120"}}),e._v(" "),i("el-table-column",{attrs:{prop:"jumptypename",width:"120",label:"打开方式"}}),e._v(" "),i("el-table-column",{attrs:{prop:"starttime",width:"300",label:"生效时间",formatter:e.formatDate}}),e._v(" "),i("el-table-column",{attrs:{prop:"isdefault",formatter:e.formatDefault,label:"是否默认"}}),e._v(" "),i("el-table-column",{attrs:{prop:"advertList[0].jumplink",label:"跳转链接",width:"300"}}),e._v(" "),i("el-table-column",{attrs:{label:"图片预览",prop:"advertList","header-align":"center",align:"center",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.advertList,function(t,a){return i("div",{key:a,staticClass:"left_imgContent"},[i("el-popover",{attrs:{placement:"right",title:"",trigger:"click"}},[i("img",{staticStyle:{"max-width":"700px","max-height":"700px"},attrs:{src:t.imgurl}}),e._v(" "),i("img",{staticStyle:{width:"80px",height:"80px"},attrs:{slot:"reference",src:t.imgurl,alt:t.imgurl},slot:"reference"})])],1)})}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"updatetime",width:"150",label:"最近修改时间"}}),e._v(" "),i("el-table-column",{attrs:{prop:"username",label:"最后修改人"}}),e._v(" "),i("el-table-column",{attrs:{prop:"status",formatter:e.formatStatus,label:"状态"}}),e._v(" "),i("el-table-column",{attrs:{fixed:"right",label:"操作",width:"230"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{disabled:1==t.row.isdefault,type:"primary",size:"mini"},on:{click:function(i){e.editDetail(t.$index,t.row)}}},[e._v("\n                                            编辑")]),e._v(" "),i("el-button",{attrs:{disabled:1==t.row.isdefault,size:"mini",type:"warning"},on:{click:function(i){e.handleStop(t.$index,t.row)}}},[e._v("\n                                            "+e._s(1==t.row.status?"停用":"启用"))]),e._v(" "),i("el-button",{attrs:{disabled:1==t.row.isdefault,type:"danger",size:"mini"},on:{click:function(i){e.deletStart(t.$index,t.row)}}},[e._v("\n                                            删除")])]}}])})],1),e._v(" "),i("el-pagination",{attrs:{"current-page":1,"page-sizes":[10,20,30,40],"page-size":10,layout:"total, sizes, prev, pager, next, jumper",total:e.startfigure.total},on:{"size-change":e.handleSizeChangeAll,"current-change":e.handleCurrentChangeAll}})]]],2)}))],1)]),e._v(" "),i("el-dialog",{attrs:{title:e.startTitle,width:"40%",center:"",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t},closed:e.closeDialog}},[i("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.startRules,"label-width":"100px",size:"mini"}},[i("el-form-item",{attrs:{label:"平台分类",prop:"devicetype"}},[i("el-select",{attrs:{disabled:e.editDisabled,placeholder:"选择投放平台"},model:{value:e.editForm.devicetype,callback:function(t){e.$set(e.editForm,"devicetype",t)},expression:"editForm.devicetype"}},e._l(e.startOptionDeviceType,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"图片名称",prop:"icontext"}},[i("el-input",{attrs:{placeholder:"请输入图片名称",autocomplete:"off"},model:{value:e.editForm.icontext,callback:function(t){e.$set(e.editForm,"icontext",t)},expression:"editForm.icontext"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"上传图片1"}},[i("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.actionUrl,drag:e.canDrag,disabled:e.loaded,"with-credentials":e.actionWidth,"show-file-list":!1,"on-progress":e.handleUploading,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.editForm.advertList[0].imgurl?i("img",{staticClass:"avatar",attrs:{src:e.editForm.advertList[0].imgurl||""}}):e._e(),e._v(" "),i("i",{staticClass:"el-icon-upload"}),e._v(" "),e.loaded?i("div",{staticClass:"el-up-loading"},[i("i",{staticClass:"el-icon-loading"}),i("br"),e._v("拼命上传中")]):e._e(),e._v(" "),i("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),i("em",[e._v("点击上传")])]),e._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过1MB，适用于正常屏幕")])])],1),e._v(" "),i("el-form-item",{attrs:{label:"图片1尺寸"}},[e.editForm.advertList[0]?i("el-input",{attrs:{readOnly:"",placeholder:"图片尺寸",autocomplete:"off"},model:{value:e.editForm.advertList[0].imgmeasure,callback:function(t){e.$set(e.editForm.advertList[0],"imgmeasure",t)},expression:"editForm.advertList[0].imgmeasure"}}):e._e()],1),e._v(" "),i("el-form-item",{attrs:{label:"图片1大小"}},[e.editForm.advertList[0]?i("el-input",{attrs:{placeholder:"图片大小",readOnly:"",autocomplete:"off"},model:{value:e.editForm.advertList[0].imgsize,callback:function(t){e.$set(e.editForm.advertList[0],"imgsize",t)},expression:"editForm.advertList[0].imgsize"}}):e._e()],1),e._v(" "),i("el-form-item",{attrs:{label:"跳转链接",prop:"jumplink"}},[i("el-input",{attrs:{placeholder:"输入跳转链接",autocomplete:"off"},model:{value:e.editForm.jumplink,callback:function(t){e.$set(e.editForm,"jumplink",t)},expression:"editForm.jumplink"}})],1),e._v(" "),2==e.editForm.devicetype?i("el-form-item",{attrs:{label:"上传图片2"}},[i("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.actionUrl,drag:e.canDrag,disabled:e.loaded,"with-credentials":e.actionWidth,"show-file-list":!1,"on-progress":e.handleUploading1,"on-success":e.handleAvatarSuccess1,"before-upload":e.beforeAvatarUpload1}},[e.editForm.advertList[1].imgurl?i("img",{staticClass:"avatar",attrs:{src:e.editForm.advertList[1].imgurl||""}}):e._e(),e._v(" "),i("i",{staticClass:"el-icon-upload"}),e._v(" "),e.loaded?i("div",{staticClass:"el-up-loading"},[i("i",{staticClass:"el-icon-loading"}),i("br"),e._v("拼命上传中")]):e._e(),e._v(" "),i("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),i("em",[e._v("点击上传")])]),e._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过1MB，适用于流海屏手机")])])],1):e._e(),e._v(" "),2==e.editForm.devicetype?i("el-form-item",{attrs:{label:"图片2尺寸"}},[e.editForm.advertList[1]?i("el-input",{attrs:{readOnly:"",placeholder:"图片尺寸",autocomplete:"off"},model:{value:e.editForm.advertList[1].imgmeasure,callback:function(t){e.$set(e.editForm.advertList[1],"imgmeasure",t)},expression:"editForm.advertList[1].imgmeasure"}}):e._e()],1):e._e(),e._v(" "),2==e.editForm.devicetype?i("el-form-item",{attrs:{label:"图片2大小"}},[e.editForm.advertList[1]?i("el-input",{attrs:{placeholder:"图片大小",readOnly:"",autocomplete:"off"},model:{value:e.editForm.advertList[1].imgsize,callback:function(t){e.$set(e.editForm.advertList[1],"imgsize",t)},expression:"editForm.advertList[1].imgsize"}}):e._e()],1):e._e(),e._v(" "),i("el-form-item",{attrs:{label:"打开方式",prop:"jumptype"}},[i("el-select",{attrs:{placeholder:"请选择打开方式"},model:{value:e.editForm.jumptype,callback:function(t){e.$set(e.editForm,"jumptype",t)},expression:"editForm.jumptype"}},e._l(e.optionsOpen,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"开始时间",prop:"starttime"}},[i("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择开始时间"},model:{value:e.editForm.starttime,callback:function(t){e.$set(e.editForm,"starttime",t)},expression:"editForm.starttime"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"结束时间",prop:"endtime"}},[i("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束时间"},model:{value:e.editForm.endtime,callback:function(t){e.$set(e.editForm,"endtime",t)},expression:"editForm.endtime"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit("editForm")}}},[e._v("确 定")])],1)],1),e._v(" "),i("el-dialog",{attrs:{visible:e.bigImgUrlDialog},on:{"update:visible":function(t){e.bigImgUrlDialog=t}}},[i("img",{attrs:{width:"100%",src:e.bigImgUrl,alt:""}})])],1)},staticRenderFns:[]};var m=i("VU/8")(d,n,!1,function(e){i("pEDK"),i("hpkB")},"data-v-c6906ea6",null);t.default=m.exports},hpkB:function(e,t){},pEDK:function(e,t){}});